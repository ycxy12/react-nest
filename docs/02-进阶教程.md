# ç¬¬äºŒé˜¶æ®µï¼šReact ä¸ NestJS è¿›é˜¶

---

## ğŸ“˜ Part 1: React è¿›é˜¶ - useEffect

### 1.1 ä»€ä¹ˆæ˜¯ useEffectï¼Ÿ

`useEffect` ç”¨äºå¤„ç†**å‰¯ä½œç”¨**ï¼Œä¾‹å¦‚ï¼š
- æ•°æ®è·å– (API è°ƒç”¨)
- è®¢é˜…/å–æ¶ˆè®¢é˜…
- æ‰‹åŠ¨æ“ä½œ DOM
- è®¾ç½®å®šæ—¶å™¨

```tsx
import { useEffect, useState } from 'react';

function UserProfile({ userId }) {
  const [user, setUser] = useState(null);

  useEffect(() => {
    // å‰¯ä½œç”¨ï¼šè·å–ç”¨æˆ·æ•°æ®
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data));
  }, [userId]);  // ä¾èµ–æ•°ç»„ï¼šuserId å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ

  return user ? <h1>{user.name}</h1> : <p>åŠ è½½ä¸­...</p>;
}
```

### 1.2 ä¾èµ–æ•°ç»„è¯¦è§£

| ä¾èµ–æ•°ç»„ | æ‰§è¡Œæ—¶æœº | ä½¿ç”¨åœºæ™¯ |
|----------|----------|----------|
| `[]` | åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ | åˆå§‹åŒ–æ•°æ®åŠ è½½ |
| `[a, b]` | a æˆ– b å˜åŒ–æ—¶æ‰§è¡Œ | å“åº” props/state å˜åŒ– |
| ä¸ä¼  | æ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ | âš ï¸ æ…ç”¨ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ |

### 1.3 æ¸…ç†å‡½æ•°

```tsx
useEffect(() => {
  const timer = setInterval(() => console.log('tick'), 1000);

  // è¿”å›æ¸…ç†å‡½æ•°ï¼Œç»„ä»¶å¸è½½æ—¶æ‰§è¡Œ
  return () => clearInterval(timer);
}, []);
```

---

## ğŸ“— Part 2: React Router è·¯ç”±

### 2.1 å®‰è£…

```bash
cd client && npm install react-router-dom
```

### 2.2 åŸºç¡€è·¯ç”±é…ç½®

```tsx
// main.tsx
import { BrowserRouter } from 'react-router-dom';

<BrowserRouter>
  <App />
</BrowserRouter>

// App.tsx
import { Routes, Route, Link } from 'react-router-dom';

function App() {
  return (
    <div>
      <nav>
        <Link to="/">é¦–é¡µ</Link>
        <Link to="/about">å…³äº</Link>
        <Link to="/users">ç”¨æˆ·</Link>
      </nav>

      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
        <Route path="/users/:id" element={<UserDetail />} />
      </Routes>
    </div>
  );
}
```

### 2.3 è·å–è·¯ç”±å‚æ•°

```tsx
import { useParams, useNavigate } from 'react-router-dom';

function UserDetail() {
  const { id } = useParams();  // è·å– URL å‚æ•°
  const navigate = useNavigate();  // ç¼–ç¨‹å¼å¯¼èˆª

  return (
    <div>
      <h1>ç”¨æˆ· ID: {id}</h1>
      <button onClick={() => navigate('/')}>è¿”å›é¦–é¡µ</button>
    </div>
  );
}
```

---

## ğŸ“™ Part 3: NestJS DTO å’ŒéªŒè¯

### 3.1 ä»€ä¹ˆæ˜¯ DTOï¼Ÿ

DTO (Data Transfer Object) å®šä¹‰è¯·æ±‚/å“åº”çš„æ•°æ®ç»“æ„ï¼Œé…åˆ `class-validator` å®ç°è‡ªåŠ¨éªŒè¯ã€‚

```bash
cd server && npm install class-validator class-transformer
```

### 3.2 åˆ›å»º DTO

```typescript
// src/todo/dto/create-todo.dto.ts
import { IsString, IsNotEmpty, IsOptional, IsBoolean } from 'class-validator';

export class CreateTodoDto {
  @IsString()
  @IsNotEmpty({ message: 'æ ‡é¢˜ä¸èƒ½ä¸ºç©º' })
  title: string;

  @IsString()
  @IsOptional()
  description?: string;

  @IsBoolean()
  @IsOptional()
  completed?: boolean = false;
}
```

### 3.3 å¯ç”¨å…¨å±€éªŒè¯

```typescript
// src/main.ts
import { ValidationPipe } from '@nestjs/common';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  
  // å¯ç”¨å…¨å±€éªŒè¯ç®¡é“
  app.useGlobalPipes(new ValidationPipe({
    whitelist: true,  // è‡ªåŠ¨ç§»é™¤éç™½åå•å±æ€§
    transform: true,  // è‡ªåŠ¨ç±»å‹è½¬æ¢
  }));
  
  await app.listen(3000);
}
```

### 3.4 åœ¨ Controller ä¸­ä½¿ç”¨

```typescript
@Post()
create(@Body() createTodoDto: CreateTodoDto) {
  // createTodoDto å·²ç»è¿‡éªŒè¯ï¼Œä¸åˆæ³•çš„è¯·æ±‚ä¼šè¿”å› 400 é”™è¯¯
  return this.todoService.create(createTodoDto);
}
```

---

## ğŸ“• Part 4: NestJS æ•°æ®åº“é›†æˆ (TypeORM)

### 4.1 å®‰è£…ä¾èµ–

```bash
cd server
npm install @nestjs/typeorm typeorm sqlite3
```

### 4.2 é…ç½®æ•°æ®åº“è¿æ¥

```typescript
// src/app.module.ts
import { TypeOrmModule } from '@nestjs/typeorm';

@Module({
  imports: [
    TypeOrmModule.forRoot({
      type: 'sqlite',
      database: 'data.db',
      entities: [Todo],
      synchronize: true,  // å¼€å‘ç¯å¢ƒè‡ªåŠ¨åŒæ­¥è¡¨ç»“æ„
    }),
  ],
})
export class AppModule {}
```

### 4.3 åˆ›å»ºå®ä½“

```typescript
// src/todo/entities/todo.entity.ts
import { Entity, Column, PrimaryGeneratedColumn, CreateDateColumn } from 'typeorm';

@Entity()
export class Todo {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  title: string;

  @Column({ nullable: true })
  description: string;

  @Column({ default: false })
  completed: boolean;

  @CreateDateColumn()
  createdAt: Date;
}
```

### 4.4 åœ¨ Service ä¸­ä½¿ç”¨ Repository

```typescript
// src/todo/todo.service.ts
import { Injectable } from '@nestjs/common';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';
import { Todo } from './entities/todo.entity';

@Injectable()
export class TodoService {
  constructor(
    @InjectRepository(Todo)
    private todoRepo: Repository<Todo>,
  ) {}

  findAll() {
    return this.todoRepo.find();
  }

  create(data: Partial<Todo>) {
    const todo = this.todoRepo.create(data);
    return this.todoRepo.save(todo);
  }

  async update(id: number, data: Partial<Todo>) {
    await this.todoRepo.update(id, data);
    return this.todoRepo.findOneBy({ id });
  }

  delete(id: number) {
    return this.todoRepo.delete(id);
  }
}
```

---

## ğŸ¯ ç»ƒä¹ ä»»åŠ¡

### React ç»ƒä¹ 
1. åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼Œä½¿ç”¨ `useEffect` ä» NestJS API è·å–æ•°æ®
2. æ·»åŠ  React Routerï¼Œåˆ›å»ºå¤šä¸ªé¡µé¢

### NestJS ç»ƒä¹ 
1. åˆ›å»º Todo æ¨¡å—ï¼Œæ·»åŠ  DTO éªŒè¯
2. é›†æˆ SQLite æ•°æ®åº“ï¼Œå®ç° CRUD æ“ä½œ
