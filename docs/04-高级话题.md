# ç¬¬å››é˜¶æ®µï¼šé«˜çº§è¯é¢˜

---

## ğŸ“˜ Part 1: Zustand çŠ¶æ€ç®¡ç†

### 1.1 ä»€ä¹ˆæ˜¯ Zustandï¼Ÿ

Zustand æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ React çŠ¶æ€ç®¡ç†åº“ï¼Œæ¯” Redux æ›´ç®€å•ï¼š
- **ç®€æ´ API**ï¼šæ— éœ€ Providerã€Reducerã€Action
- **TypeScript å‹å¥½**ï¼šå¼€ç®±å³ç”¨çš„ç±»å‹æ¨æ–­
- **ä½“ç§¯å°**ï¼šä»… 1KB gzipped

### 1.2 åŸºæœ¬ç”¨æ³•

```tsx
// stores/useUserStore.ts
import { create } from 'zustand';

interface User {
  id: number;
  name: string;
  email: string;
}

interface UserState {
  user: User | null;
  isLoggedIn: boolean;
  login: (user: User) => void;
  logout: () => void;
}

export const useUserStore = create<UserState>((set) => ({
  user: null,
  isLoggedIn: false,
  
  login: (user) => set({ user, isLoggedIn: true }),
  logout: () => set({ user: null, isLoggedIn: false }),
}));
```

### 1.3 åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```tsx
function UserProfile() {
  const { user, isLoggedIn, logout } = useUserStore();

  if (!isLoggedIn) {
    return <p>è¯·å…ˆç™»å½•</p>;
  }

  return (
    <div>
      <h1>æ¬¢è¿, {user?.name}</h1>
      <button onClick={logout}>é€€å‡ºç™»å½•</button>
    </div>
  );
}
```

### 1.4 æŒä¹…åŒ–å­˜å‚¨

```tsx
import { persist } from 'zustand/middleware';

export const useUserStore = create<UserState>()(
  persist(
    (set) => ({
      user: null,
      isLoggedIn: false,
      login: (user) => set({ user, isLoggedIn: true }),
      logout: () => set({ user: null, isLoggedIn: false }),
    }),
    { name: 'user-storage' }  // localStorage key
  )
);
```

---

## ğŸ“— Part 2: JWT è®¤è¯

### 2.1 åç«¯ - NestJS JWT é…ç½®

```bash
cd server && npm install @nestjs/jwt @nestjs/passport passport passport-jwt bcrypt
npm install -D @types/passport-jwt @types/bcrypt
```

### 2.2 ç”¨æˆ·å®ä½“

```typescript
// src/user/entities/user.entity.ts
@Entity('users')
export class User {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ unique: true })
  email: string;

  @Column()
  password: string;  // åŠ å¯†åçš„å¯†ç 

  @Column()
  name: string;

  @CreateDateColumn()
  createdAt: Date;
}
```

### 2.3 Auth Service

```typescript
// src/auth/auth.service.ts
@Injectable()
export class AuthService {
  constructor(
    private usersService: UsersService,
    private jwtService: JwtService,
  ) {}

  async validateUser(email: string, password: string) {
    const user = await this.usersService.findByEmail(email);
    if (user && await bcrypt.compare(password, user.password)) {
      const { password, ...result } = user;
      return result;
    }
    return null;
  }

  async login(user: User) {
    const payload = { email: user.email, sub: user.id };
    return {
      access_token: this.jwtService.sign(payload),
      user: { id: user.id, email: user.email, name: user.name },
    };
  }

  async register(dto: RegisterDto) {
    const hashedPassword = await bcrypt.hash(dto.password, 10);
    const user = await this.usersService.create({
      ...dto,
      password: hashedPassword,
    });
    return this.login(user);
  }
}
```

### 2.4 JWT å®ˆå«

```typescript
// src/auth/jwt.guard.ts
@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {}

// ä½¿ç”¨å®ˆå«ä¿æŠ¤è·¯ç”±
@Controller('todos')
@UseGuards(JwtAuthGuard)
export class TodoController {
  // æ‰€æœ‰è·¯ç”±éƒ½éœ€è¦è®¤è¯
}
```

### 2.5 å‰ç«¯ - ç™»å½•æµç¨‹

```tsx
// ç™»å½•å¹¶å­˜å‚¨ token
const login = async (email: string, password: string) => {
  const res = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password }),
  });
  const data = await res.json();
  
  // å­˜å‚¨ token
  localStorage.setItem('token', data.access_token);
  
  // æ›´æ–° Zustand store
  useUserStore.getState().login(data.user);
};

// API è¯·æ±‚æºå¸¦ token
const fetchWithAuth = async (url: string, options: RequestInit = {}) => {
  const token = localStorage.getItem('token');
  return fetch(url, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Bearer ${token}`,
    },
  });
};
```

---

## ğŸ“™ Part 3: Swagger API æ–‡æ¡£

### 3.1 å®‰è£…

```bash
cd server && npm install @nestjs/swagger
```

### 3.2 é…ç½®

```typescript
// src/main.ts
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // Swagger é…ç½®
  const config = new DocumentBuilder()
    .setTitle('Todo API')
    .setDescription('Todo å…¨æ ˆåº”ç”¨ API æ–‡æ¡£')
    .setVersion('1.0')
    .addBearerAuth()  // JWT è®¤è¯
    .build();

  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('api', app, document);

  await app.listen(3000);
  console.log('ğŸ“š API æ–‡æ¡£: http://localhost:3000/api');
}
```

### 3.3 è£…é¥° DTO

```typescript
import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';

export class CreateTodoDto {
  @ApiProperty({ description: 'ä»»åŠ¡æ ‡é¢˜', example: 'å­¦ä¹  NestJS' })
  @IsString()
  @IsNotEmpty()
  title: string;

  @ApiPropertyOptional({ description: 'ä»»åŠ¡æè¿°' })
  @IsString()
  @IsOptional()
  description?: string;
}
```

### 3.4 è£…é¥° Controller

```typescript
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';

@ApiTags('todos')
@ApiBearerAuth()
@Controller('todos')
export class TodoController {
  
  @Get()
  @ApiOperation({ summary: 'è·å–æ‰€æœ‰ Todo' })
  @ApiResponse({ status: 200, description: 'æˆåŠŸè¿”å› Todo åˆ—è¡¨' })
  findAll() {
    return this.todoService.findAll();
  }

  @Post()
  @ApiOperation({ summary: 'åˆ›å»ºæ–° Todo' })
  @ApiResponse({ status: 201, description: 'åˆ›å»ºæˆåŠŸ' })
  @ApiResponse({ status: 400, description: 'å‚æ•°éªŒè¯å¤±è´¥' })
  create(@Body() dto: CreateTodoDto) {
    return this.todoService.create(dto);
  }
}
```

---

## ğŸ¯ å®æˆ˜ä»»åŠ¡

æœ¬é˜¶æ®µå°†å®ç°ï¼š
1. âœ… Zustand å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆç”¨æˆ·ç™»å½•çŠ¶æ€ï¼‰
2. âœ… JWT è®¤è¯ï¼ˆæ³¨å†Œã€ç™»å½•ã€ç™»å‡ºï¼‰
3. âœ… Swagger API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
4. âœ… è·¯ç”±å®ˆå«ï¼ˆä¿æŠ¤éœ€è¦è®¤è¯çš„é¡µé¢ï¼‰
